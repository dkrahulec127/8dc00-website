

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Topic 1.1: Geometrical transformations &mdash; Medical Image Analysis (8DC00) v0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Topic 1.2: Point-based registration" href="1.2_Registration_point-based-registration.html" />
    <link rel="prev" title="Topic 0.1: Course practicalities" href="0.1_Python_programming_skills.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Medical Image Analysis (8DC00)
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="0.1_Python_programming_skills.html">Topic 0.1: Course practicalities</a></li>
</ul>
<p class="caption"><span class="caption-text">Registration</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Topic 1.1: Geometrical transformations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#1.-Review-of-linear-algebra">1. Review of linear algebra</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Scalars">Scalars</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Vectors">Vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Matrices">Matrices</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Matrix-(Dot)-Product"><em>Matrix (Dot) Product</em></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Matrix-transpose"><em>Matrix transpose</em></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Identity-matrix"><em>Identity matrix</em></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Matrix-inversion"><em>Matrix inversion</em></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Special-matrices-and-vectors">Special matrices and vectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Systems-of-equations">Systems of equations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Norms">Norms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Determinant">Determinant</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#2.-Introduction-to-(medical)-image-registration">2. Introduction to (medical) image registration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Applications-of-registration">Applications of registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Classification-of-registration-methods">Classification of registration methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Causes-of-medical-image-misalignment:">Causes of medical image misalignment:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#3.-Geometrical-transformations-(theory-and-exercises)">3. Geometrical transformations (theory and exercises)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#3.1-Rigid-transformations">3.1 Rigid transformations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Translation">Translation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Rotation">Rotation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Exercise-3.1.1:"><em>Exercise 3.1.1</em>:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Question-3.1.1:"><em>Question 3.1.1:</em></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#3.2-Nonrigid-transformations">3.2 Nonrigid transformations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Scaling">Scaling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Reflection">Reflection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Shearing">Shearing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Exercise-3.2.1:"><em>Exercise 3.2.1</em>:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Question-3.2.1:"><em>Question 3.2.1</em>:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Question-3.2.2:"><em>Question 3.2.2</em>:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#3.3-Transform-composition">3.3 Transform composition</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Question-3.3.1:"><em>Question 3.3.1:</em></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Question-3.3.2:"><em>Question 3.3.2:</em></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Exercise-3.3.1:"><em>Exercise 3.3.1</em>:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#3.4-Homogeneous-coordinates">3.4 Homogeneous coordinates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Exercise-3.4.1:"><em>Exercise 3.4.1</em>:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#References">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="1.2_Registration_point-based-registration.html">Topic 1.2: Point-based registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.3_Registration_intensity-based-registration.html">Topic 1.3: Intensity-based registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.5_Registration_active-shape-models.html">Topic 1.5: Active shape models</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.6_Registration_project.html">Project 1: Medical image registration</a></li>
</ul>
<p class="caption"><span class="caption-text">Computer-aided diagnosis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="2.1_CAD_linear_regression.html">Topic 2.1: Linear regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.2_CAD_kNN_decision_trees.html">Topic 2.2: k-Means, k-Nearest Neighbors, decision trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.3_CAD_generalization_overfitting.html">Topic 2.3: Generalization and overfitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.4_CAD_logistic_regression.html">Topic 2.4: Logistic regression</a></li>
</ul>
<p class="caption"><span class="caption-text">Convolutional neural networks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="2.5_CNNs_fundamental_building_blocks.html">Topic 2.5: Fundamental building blocks of neural networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.6_CNNs_unsupervised_learning_PCA.html">Topic 2.6: (Un)supervised learning, PCA</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.8_CAD_project.html">Project 2: Computer-aided diagnosis</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Medical Image Analysis (8DC00)</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Topic 1.1: Geometrical transformations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/reader/1.1_Registration_geometrical-transformations.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Topic-1.1:-Geometrical-transformations">
<h1>Topic 1.1: Geometrical transformations<a class="headerlink" href="#Topic-1.1:-Geometrical-transformations" title="Permalink to this headline">¶</a></h1>
<p>This notebook combines theory with exercises to support the understanding of geometrical transformations in medical image analysis. Implement all functions in the <code class="docutils literal notranslate"><span class="pre">code</span></code> folder of your cloned repository, and test it in this notebook after implementation by importing your functions to this notebook. Use available markdown sections to fill in your answers to questions as you proceed through the notebook.</p>
<p><strong>Contents:</strong></p>
<ol class="arabic">
<li><p><a class="reference external" href="#linalg">Review of linear algebra</a></p></li>
<li><p><a class="reference external" href="#intromir">Introduction to medical image registration</a></p></li>
<li><p><a class="reference external" href="#geomtrans">Geometrical transformations (theory and exercises)</a></p>
<p>3.1 <a class="reference external" href="#rigtrans">Rigid transformations</a> 3.2 <a class="reference external" href="#nonrigtrans">Nonrigid transformations</a> 3.3 <a class="reference external" href="#transcomp">Transform composition</a> 3.4 <a class="reference external" href="#coordinates">Homogeneous coordinates</a></p>
</li>
</ol>
<p><p><img alt="3bfbf3543df64e79ac2aa3a6ae603fbe" class="no-scaled-link" src="../_images/read_ico.png" style="width: 42px; height: 42px;" /></p>
</p><section id="1.-Review-of-linear-algebra">
<h2>1. Review of linear algebra<a class="headerlink" href="#1.-Review-of-linear-algebra" title="Permalink to this headline">¶</a></h2>
<p>For animated explanation of linear algebra, you may refer to many YouTube channels, e.g. Essence of linear algebra.</p>
<section id="Scalars">
<h3>Scalars<a class="headerlink" href="#Scalars" title="Permalink to this headline">¶</a></h3>
<p>A scalar is a single number, and can be represented by integers, real numbers, rational numbers, etc. Scalars are denoted with italic font: <em>a</em>, <em>n</em>, <em>t</em>.</p>
</section>
<section id="Vectors">
<h3>Vectors<a class="headerlink" href="#Vectors" title="Permalink to this headline">¶</a></h3>
<p>In mathematical terms, a vector is a 1-D array of numbers, while in physics terms, a vector is simply an arrow pointing in space, defined by its length and direction. While in physics, vectors do not have a common origin, in linear algebra, they typically start from the root of a coordinate system (e.g. x,y,z). Computer scientists define vectors as ordered lists of numbers. Vectors can be real, binary, integer, etc. An example notation for type and size of real vectors: <span class="math notranslate nohighlight">\(\mathbb{R}^n\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
x &amp;= \begin{bmatrix}
x_{1} \\
x_{2} \\
\vdots \\
x_{n}
\end{bmatrix}
\end{align}\end{split}\]</div>
<p>In Python, we can create a vector of three elements using numpy (np) arrays or the function arange.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> <span class="c1"># importing the numpy library</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># arrays are type-set in square brackets</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Vector x is:</span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># the reshape function takes rows and columns as input arguments</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Vector y is:</span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s1">. It has length of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="s1"> elements, and shape </span><span class="si">{</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Vector x is:
 [0 1 2]

Vector y is:
 [[0]
 [1]
 [2]]. It has length of 3 elements, and shape (3, 1).
</pre></div></div>
</div>
</section>
<section id="Matrices">
<h3>Matrices<a class="headerlink" href="#Matrices" title="Permalink to this headline">¶</a></h3>
<p>A matrix is a finite-dimensional rectangular array of numbers arranged in rows and columns. Whenever referring to a matrix element, it is common to first list row (<span class="math notranslate nohighlight">\(i\)</span>) before collumn (<span class="math notranslate nohighlight">\(j\)</span>) indices. The type and shape of matrix <span class="math notranslate nohighlight">\(A\)</span> can be denoted as <span class="math notranslate nohighlight">\(\pmb{A} \in \mathbb{R}^{m\,\times\,n}\)</span>, where elements are arranged as follows:</p>
<p><span class="math">\begin{align}
\pmb{A} &= \begin{bmatrix}
A_{1,1}\,\,\,\,A_{1,2} \\
A_{2,1}\,\,\,\,A_{2,2}
\end{bmatrix}
\end{align}</span></p>
<p>In Python, we can create a matrix using the np.matrix() function, specifying row elements in comma-separated blocks:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Matrix M: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Matrix M:
 [[1 2]
 [3 4]]
</pre></div></div>
</div>
</section>
<section id="Matrix-(Dot)-Product">
<h3><em>Matrix (Dot) Product</em><a class="headerlink" href="#Matrix-(Dot)-Product" title="Permalink to this headline">¶</a></h3>
<p>There are various operations that are done on matrices. Besides addition and subtraction, these operations can include multiplication by a scalar, a vector or another matrix. Scalar multiplication means that each element of a matrix is multiplied by a scalar. If we multiply an <span class="math notranslate nohighlight">\(m \times n\)</span> matrix by a vector, then the output is a linear combination of all columns (<span class="math notranslate nohighlight">\(\pmb{C} = \pmb{AB}\)</span>, where <span class="math notranslate nohighlight">\(\pmb{C}_{i,j} = \sum_{k}\,\pmb{A}_{i,k}\,\pmb{B}_{k,j}\)</span>). It is however important to
realize that <em>order matters</em>, i.e. matrix multiplication is not commutative (<span class="math notranslate nohighlight">\(\pmb{AB} \neq \pmb{BA}\)</span>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Example of matrix multiplication</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>

<span class="c1"># Possible multiplication</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Multiplication of A*B: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">A</span><span class="o">*</span><span class="n">B</span><span class="p">)</span>

<span class="c1"># Multiplication is not commutative (you can check the output error by removing the hash sign below)</span>
<span class="c1">#print(&quot;\nMultiplication of B*A: \n&quot;, B*A)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Multiplication of A*B:
 [[-1  9  3]
 [-2  7  3]]
</pre></div></div>
</div>
</section>
<section id="Matrix-transpose">
<h3><em>Matrix transpose</em><a class="headerlink" href="#Matrix-transpose" title="Permalink to this headline">¶</a></h3>
<p>The transpose of a matrix can be thought of as a mirror image across the main diagonal. The first column becomes the first row, the second column becomes the second row, etc. An <span class="math notranslate nohighlight">\(n \times m\)</span> matrix is said to be symmetric if <span class="math notranslate nohighlight">\(\mathbf{A} = \mathbf{A}^{\top}\)</span>, and skew symmetric if <span class="math notranslate nohighlight">\(\mathbf{A}^{\top} = - \mathbf{A}\)</span>. In other words, <span class="math notranslate nohighlight">\((\pmb{A}^\top)_{i,j} = \pmb{A}_{i,j}\)</span>, and <span class="math notranslate nohighlight">\((\pmb{AB})^\top = \pmb{B}^\top\pmb{A}^\top\)</span>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Matrix transpose is done using the transpose() function</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Matrix M: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Matrix M transposed: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Matrix M:
 [[1 3]
 [2 4]]

Matrix M transposed:
 [[1 3]
 [2 4]]
</pre></div></div>
</div>
</section>
<section id="Identity-matrix">
<h3><em>Identity matrix</em><a class="headerlink" href="#Identity-matrix" title="Permalink to this headline">¶</a></h3>
<p>An identity matrix of size <span class="math notranslate nohighlight">\(n \times n\)</span> is a square matrix with ones on its main diagonal and all other elements equal to zero, i.e. <span class="math notranslate nohighlight">\(\forall\pmb{x}\in \mathbb{R}^{n},\pmb{I}_{n}\pmb{x} = \pmb{x}\)</span>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\pmb{I} &amp;= \begin{bmatrix}
1 \,\,\,\, 0 \,\,\,\, 0 \\
0 \,\,\,\, 1 \,\,\,\, 0 \\
0 \,\,\,\, 0 \,\,\,\, 1
\end{bmatrix}
\end{align}\end{split}\]</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Identity matrix can be created using the eye() or identity () function</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span> <span class="c1">#dtype determines the data type of a variable</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Matrix N with eye(): </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Matrix M with identity(): </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Matrix N with eye():
 [[1. 0. 0.]
 [0. 1. 0.]
 [0. 0. 1.]]

Matrix M with identity():
 [[1. 0.]
 [0. 1.]]
</pre></div></div>
</div>
</section>
<section id="Matrix-inversion">
<h3><em>Matrix inversion</em><a class="headerlink" href="#Matrix-inversion" title="Permalink to this headline">¶</a></h3>
<p>A matrix inverse is a matrix which when multiplied by the original matrix will yield an identity matrix. Matrix inverse is denoted as: <span class="math notranslate nohighlight">\(\pmb{A}^{-1}\pmb{A} = \pmb{I}_{n}\)</span>. However, not all matrices have their inverse form. The inverse of a matrix exists only if the matrix is non-singular (<span class="math notranslate nohighlight">\(\det A \neq 0\)</span>). A system of equations can be solved using matrix inverse as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{matrix}
\begin{align}
\pmb{Ax} &amp;= b \\
\pmb{A}^{-1}\pmb{Ax} &amp;= \pmb{A}^{-1}\pmb{b} \\
\pmb{I}_{n}\pmb{x} &amp;= \pmb{A}^{-1}\pmb{b} \\
\end{align}
\end{matrix}\end{split}\]</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Matrix inversion can be calculated using the numpy function linalg.inv():</span>

<span class="c1"># Taking a 3 * 3 matrix</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]])</span>

<span class="n">A_inv</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="c1"># Calculating the inverse of the matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The inverse of matrix A is: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">A_inv</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The inverse of matrix A is:
 [[ 0.176 -0.003 -0.023]
 [ 0.059 -0.131  0.085]
 [-0.118  0.15   0.052]]
</pre></div></div>
</div>
</section>
<section id="Special-matrices-and-vectors">
<h3>Special matrices and vectors<a class="headerlink" href="#Special-matrices-and-vectors" title="Permalink to this headline">¶</a></h3>
<p>There is a plethora of special matrices and vectors in linear algebra, the explanation of which is beyond the scope of this notebook. To name a couple of examples, a unit vector is a vector of length 1: <span class="math notranslate nohighlight">\(||\pmb{x}||_{2} = 1\)</span>; a symmetric matrix is a matrix which is equal to its transposed form: <span class="math notranslate nohighlight">\(\pmb{A} = \pmb{A}^\top\)</span>; and a square matrix is said to be orthogonal or orthonormal if its transpose is equal to the inverse (<span class="math notranslate nohighlight">\(\pmb{A}^{-1} = \pmb{A}^\top\)</span>) of that matrix:
<span class="math notranslate nohighlight">\(\pmb{A}^\top\pmb{A} = \pmb{A}\pmb{A}^\top = \pmb{I}\)</span>.</p>
</section>
<section id="Systems-of-equations">
<h3>Systems of equations<a class="headerlink" href="#Systems-of-equations" title="Permalink to this headline">¶</a></h3>
<p>Via the so-called augmented matrices, one can solve systems of equations. This process is not vastly different from what you normally do when solving single equations. Augmented matrices contain all equation arguments as rows. The operations on these rows consist of switching two rows, multiplication of a row by a nonzero number, and replacing a row by a multiple of another row added to it. Any row operation can be undone by another inverse row operation. Here, we show an example in Python to
solve the following system of equations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{matrix}
\begin{align}
8x + 3y - 2z &amp;= 9 \\
-4x + 7y + 5z &amp;= 15 \\
3x + 4y - 12z &amp;= 35
\end{align}
\end{matrix}\end{split}\]</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Solving systems of equations is easy using the numpy function linalg.solve():</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">]])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">9</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">35</span><span class="p">])</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Solution for given system of equations [x,y,z] is: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Solution for given system of equations [x,y,z] is:
 [-0.58  3.23 -1.99]
</pre></div></div>
</div>
</section>
<section id="Norms">
<h3>Norms<a class="headerlink" href="#Norms" title="Permalink to this headline">¶</a></h3>
<p>Norms are defined as functions that measure the magnitude of a matrix or vector. E.g. the distance of a vector from its origin is called a Euclidean norm, which can also be defined as the square root of the inner product of a vector with itself. The norm of a matrix expresses the magnitude of that matrix regardless of the number of its elements. Vector norms have the following three properties:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{matrix}
\begin{align}
f(\pmb{x}) &amp;= 0 \Longrightarrow \pmb{x} = 0 \\
f(\pmb{x + y}) &amp;\leq f(\pmb{x}) + f(\pmb{y})\,\,\,\,\text{(triangle inequality)} \\
\forall\alpha \in \mathbb{R}, f(\alpha\pmb{x}) &amp;= |\alpha|f(\pmb{x}) \\
\end{align}
\end{matrix}\end{split}\]</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Norms can be calculated in Python using the numpy function linalg.norm()</span>
<span class="c1"># This function returns one of the seven matrix norms</span>
<span class="c1"># or one of the infinite vector norms depending upon the value of its parameters.</span>

<span class="c1"># initialize vector</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># compute norm of vector</span>
<span class="n">x_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Vector norm of x is: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">x_norm</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Vector norm of x is:
 49.7
</pre></div></div>
</div>
</section>
<section id="Determinant">
<h3>Determinant<a class="headerlink" href="#Determinant" title="Permalink to this headline">¶</a></h3>
<p>Determinant of a matrix is a special number defined only for square matrices, representing the matrix in terms of a real number which can be used to solve systems of linear equations and finding matrix inverse. Determinant of a transformation matrix <span class="math notranslate nohighlight">\(\textbf{T}\)</span> is the signed area of a unit square shape after transforming with <span class="math notranslate nohighlight">\(\textbf{T}\)</span>. The sign reflects whether the orientation has changed or not. The determinant of a <span class="math notranslate nohighlight">\(2 \times 2\)</span> matrix is calculated as the subtraction of
cross-diagonal element multiplication. It is common to use the absolute value of the determinant:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\det\begin{pmatrix} a &amp; b \\ c &amp; d \end{pmatrix} = |ad - bc|
\end{align}\end{split}\]</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># The determinant of a matrix can be calculated using the numpy function linalg.det():</span>

<span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]])</span>

<span class="n">M_det</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">M</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Determinant of matrix M: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">M_det</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Determinant of matrix M:
 2.0000000000000004
</pre></div></div>
</div>
<p><p><img alt="c5dca2f5984f4f1bbc75e257c0002d23" class="no-scaled-link" src="../_images/read_ico.png" style="width: 42px; height: 42px;" /></p>
</p></section>
</section>
<section id="2.-Introduction-to-(medical)-image-registration">
<h2>2. Introduction to (medical) image registration<a class="headerlink" href="#2.-Introduction-to-(medical)-image-registration" title="Permalink to this headline">¶</a></h2>
<p>Image registration is the determination of a geometrical transformation that aligns one view of an object with another view of that object or another object. The term “view” refers to a two-, three-dimensional image or the physical representation of an object in space. An example of two-dimensional image types may be x-ray projections captured as a digital radiograph or a light projection in a video frame. Three-dimensional images can be collected by imaging modalities commonly used in hospital
settings, e.g. computed tomography (CT) or magnetic resonance (MR) imaging scanners. Generally, images are stored as discrete arrays of intensity values, and in medical applications, the object in each view will represent an anatomical region of interest. Explained mathematically, the inputs of registration are two views, which we map together by matching points positioned in one view to points in another view.</p>
<section id="Applications-of-registration">
<h3>Applications of registration<a class="headerlink" href="#Applications-of-registration" title="Permalink to this headline">¶</a></h3>
<p>Registration may be applied to various purposes. It allows us to combine information from different sources (MR-guided radiotherapy planning) or investigate longitudinal changes in e.g. post-treatment patient monitoring. Moreover, registration procedures are employed when studying group changes across multiple subjects in a trial. Last but not least, registration can aid in segmentation tasks when mapping atlases with anatomical model priors to a newly acquired medical image, or when performing
e.g. motion-induced image artefact corrections.</p>
</section>
<section id="Classification-of-registration-methods">
<h3>Classification of registration methods<a class="headerlink" href="#Classification-of-registration-methods" title="Permalink to this headline">¶</a></h3>
<p>There is a complex categorization of registration methods in the field. The following eight categories have been proposed in relevant literature [1]: image dimensionality, registration basis, geometrical transformation, degree of interaction, optimization procedure, modalities, subject, and object. In medical applications, we typically work with individual two-dimensional slices or three-dimensional image volumes, which may be acquired sequentially over time or as a series of multiple 3D volumes
(e.g. diffusion MR images). Registration may be performed via various bases, using either a location in respective views (point-based registration) or intensity similarities (intensity-based registration). Further classification of registration methods can be based on geometrical transformations, i.e. which geometrical manipulation (rigid, affine, nonlinear, etc.) are applied for alignment between two different spaces. Registration can be either automatic or semi-automatic, depending on the
amount of human interaction during the registration process. The quality of registration output is estimated continuously during the procedure either as a closed-form solution or iteratively. At last, registration methods are stratified according to the amount of modalities they involve (multi-modal, intra-modal), the subjects involved in a trial (inter-subject, intra-patient, atlas-based), and commonly also the anatomical object of interest (e.g. brain, liver, etc.).</p>
</section>
<section id="Causes-of-medical-image-misalignment:">
<h3>Causes of medical image misalignment:<a class="headerlink" href="#Causes-of-medical-image-misalignment:" title="Permalink to this headline">¶</a></h3>
<p>There are various reasons for misalignments across multiple images / volumes in a series or two images acquired at different time points. In measurements where patient compliance is crucial, different patient positioning, physiological movements of organs (heart beat, breathing, cerebrospinal fluid flow), patient motion during image acquisition, and distortions caused by imaging systems (e.g. due to the design of imaging sequences in magnetic resonance imaging) can cause data misalignment. In
cases where image acquisition includes interventions (e.g. surgery, chemotherapy, biopsy), users benefit from image registration as well.</p>
<p>An example of how digital subtraction angiography benefits from image registration:</p>
<center width="100%"><p><img alt="fd624fabb42b4aadb2848c3f06eb0947" class="no-scaled-link" src="../_images/digital_subtraction_angiography.png" style="width: 700px;" /></p>
</center><p><p><img alt="adfe6ece77fb4d28aef5bd764bc591c6" class="no-scaled-link" src="../_images/read_ico.png" style="width: 42px; height: 42px;" /></p>
</p></section>
</section>
<section id="3.-Geometrical-transformations-(theory-and-exercises)">
<h2>3. Geometrical transformations (theory and exercises)<a class="headerlink" href="#3.-Geometrical-transformations-(theory-and-exercises)" title="Permalink to this headline">¶</a></h2>
<p>In registration operations, each view involved is defined by a coordinate system. As written above, registration is the act of mapping points from space <span class="math notranslate nohighlight">\(X\)</span> to space <span class="math notranslate nohighlight">\(Y\)</span>. A successful registration is achieved when the point <span class="math notranslate nohighlight">\(y\)</span> in space <span class="math notranslate nohighlight">\(Y\)</span> is approximately equal or completely correpondent to <span class="math notranslate nohighlight">\(x^{\prime}\)</span> after a transformation <span class="math notranslate nohighlight">\(T\)</span> has been applied to point <span class="math notranslate nohighlight">\(x\)</span> in <span class="math notranslate nohighlight">\(X\)</span>. In the picture below, geometrical transformation <span class="math notranslate nohighlight">\(T\)</span> aligns the moving
axial brain scan with the fixed one.</p>
<center width="100%"><p><img alt="d1c9753da8df4f35af28fcc36d01cd10" class="no-scaled-link" src="../_images/fixed_moving.png" style="width: 700px;" /></p>
</center></section>
<section id="3.1-Rigid-transformations">
<h2>3.1 Rigid transformations<a class="headerlink" href="#3.1-Rigid-transformations" title="Permalink to this headline">¶</a></h2>
<p>Rigid transformations (or mappings) are geometrical alignments of two objects that preserve distances, the planarity of surfaces and angles between straight lines. The so-called rigid registration problems involve object translation and rotation.</p>
<section id="Translation">
<h3>Translation<a class="headerlink" href="#Translation" title="Permalink to this headline">¶</a></h3>
<p>Translation is arguably the “simplest” geometrical transformation that can be applied to an object. Assuming that the coordinates of a 2D geometric object are stored in the variable <span class="math notranslate nohighlight">\(X\)</span> (the first row contains the horizontal coordinates and the second row contains the vertical coordinates), translation of the geometric object can be performed by adding a 2D translation vector <span class="math notranslate nohighlight">\(X_{t}\)</span> to every vertex of <span class="math notranslate nohighlight">\(X\)</span>, as shown in the Python example below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># An example of translation in Python:</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">]])</span>
<span class="n">Xt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>

<span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">Xt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">Xt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Translation of the first vector X[0,:]: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Translation of the second vector X[1,:]: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,:])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Translation of the first vector X[0,:]:
 [[5 6 7]]

Translation of the second vector X[1,:]:
 [[ 6  9 11]]
</pre></div></div>
</div>
</section>
<section id="Rotation">
<h3>Rotation<a class="headerlink" href="#Rotation" title="Permalink to this headline">¶</a></h3>
<p>Image rotation is a rigid transformation that requires a rotation angle <span class="math notranslate nohighlight">\(\theta\)</span> defining the number of degrees for rotation. Typically, rotation is done about image origin (e.g. <span class="math notranslate nohighlight">\(x_{0}, y_{0}\)</span>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># An example of rotation in Python using numpy and scipy:</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">]])</span>

<span class="n">X_rotated_90</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">rotate</span>
<span class="n">X_rotated_270</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">angle</span> <span class="o">=</span> <span class="mi">270</span><span class="p">,</span> <span class="n">reshape</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Rotation by 90 degrees: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">X_rotated_90</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Rotation by 270 degrees: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">X_rotated_270</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Rotation by 90 degrees:
 [[3 6]
 [2 4]
 [1 1]]

Rotation by 270 degrees:
 [[1 1]
 [4 2]
 [6 3]]
</pre></div></div>
</div>
<p><p><img alt="7f3663aac3ec4e12abaf8fe7925108e2" class="no-scaled-link" src="../_images/todo_ico.png" style="width: 42px; height: 42px;" /></p>
</p></section>
<section id="Exercise-3.1.1:">
<h3><em>Exercise 3.1.1</em>:<a class="headerlink" href="#Exercise-3.1.1:" title="Permalink to this headline">¶</a></h3>
<p>Write an example that rotates the test object by 45° around the first vertex (hint: the first vertex is <code class="docutils literal notranslate"><span class="pre">X[:,0]</span></code> and <code class="docutils literal notranslate"><span class="pre">t2h(reg.identity(),</span> <span class="pre">Xt)</span></code> is a homogeneous transformation matrix that performs only translation). Save the example in the provided <code class="docutils literal notranslate"><span class="pre">arbitrary_rotation()</span></code> template in the <a class="reference external" href="../code/registration_tests.py">registration_tests.py</a> module. The result should match the one shown in the figure below.</p>
<p><img alt="85425f422e2f44198c7b3bd1eba67b7a" class="no-scaled-link" src="../_images/arbitrary_rotation.png" style="width: 400px;" /></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;../code&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">registration_tests</span> <span class="kn">import</span> <span class="n">arbitrary_rotation</span>

<span class="c1">#arbitrary_rotation()</span>
</pre></div>
</div>
</div>
<p><p><img alt="4b797d99197d45aba2aeb413483cc0eb" class="no-scaled-link" src="../_images/question_ico.png" style="width: 42px; height: 42px;" /></p>
</p></section>
<section id="Question-3.1.1:">
<h3><em>Question 3.1.1:</em><a class="headerlink" href="#Question-3.1.1:" title="Permalink to this headline">¶</a></h3>
<p><strong>Assuming you have implemented the missing functionality correctly, will the following line of code result in an apparent clockwise or counter-clockwise rotation of the image? Motivate your answer. (Hint: think about the coordinate system of the image, also shown in the figures illustrating forward and inverse mapping above.)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">It</span> <span class="o">=</span> <span class="n">image_transform</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">t2h</span><span class="p">(</span><span class="n">rotate</span><span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<p>Type your answer here</p>
<p><p><img alt="8d5f71242e614c53a5dcf2b4e9ac3a9d" class="no-scaled-link" src="../_images/read_ico.png" style="width: 42px; height: 42px;" /></p>
</p></section>
</section>
<section id="3.2-Nonrigid-transformations">
<h2>3.2 Nonrigid transformations<a class="headerlink" href="#3.2-Nonrigid-transformations" title="Permalink to this headline">¶</a></h2>
<p>Nonrigid transformations are essential in registration operations for interpatient comparisons of rigid anatomies, as well as intrapatient registration of anatomical structures with artifactual distortions induced during image acquisition of nonrigid anatomies (e.g. MRI scans of beating heart). Nonrigid transformations include scaling, where the straightness of lines and the angles between them are preserved (used e.g. to suppress calibration errors in MR scanners), and affine transformations,
where the angle between lines may be changed (used e.g. in deskewing a CT image after improper gantry angle recording). Further examples of nonrigid registrations comprise projective, perspective and curved registration methods (see chapters…)</p>
<p>Let us leave translation aside for now and focus on the other, more complex geometrical transformations. The identity, scaling, reflection and shearing transformations (or any combination of these transformations) can be performed by multiplying the matrix of coordinates <span class="math notranslate nohighlight">\(X\)</span> with an appropriate transformation matrix <span class="math notranslate nohighlight">\(T\)</span>. Here is an example of Python code that compute transformation matrices for the identity transformation (which is not really a transformation) and scaling:</p>
<section id="Scaling">
<h3>Scaling<a class="headerlink" href="#Scaling" title="Permalink to this headline">¶</a></h3>
<p>Scaling can be performed for example in the following way: <code class="docutils literal notranslate"><span class="pre">X_scaled</span> <span class="pre">=</span> <span class="pre">scale(2,3)*X</span></code>. To verify this, we can use the provided <code class="docutils literal notranslate"><span class="pre">test_object()</span></code> function in the <code class="docutils literal notranslate"><span class="pre">registration_util.py</span></code> module that returns a test geometrical object in the shape of the letter <em>F</em>, and plot the original object and a scaled version of it (the provided <code class="docutils literal notranslate"><span class="pre">plot_object()</span></code> function in the <code class="docutils literal notranslate"><span class="pre">registration_util.py</span></code> module can be used to plot the geometrical object) as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">registration</span> <span class="k">as</span> <span class="nn">reg</span>
<span class="kn">import</span> <span class="nn">registration_util</span> <span class="k">as</span> <span class="nn">util</span>

<span class="k">def</span> <span class="nf">identity</span><span class="p">():</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">T</span>

<span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">):</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">sx</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">sy</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">T</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">test_object</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">util</span><span class="o">.</span><span class="n">plot_object</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">util</span><span class="o">.</span><span class="n">plot_object</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">X_scaled</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/reader_1.1_Registration_geometrical-transformations_32_0.png" src="../_images/reader_1.1_Registration_geometrical-transformations_32_0.png" />
</div>
</div>
</section>
<section id="Reflection">
<h3>Reflection<a class="headerlink" href="#Reflection" title="Permalink to this headline">¶</a></h3>
<p>Reflection is the mirror transformation of an image along a given axis.</p>
</section>
<section id="Shearing">
<h3>Shearing<a class="headerlink" href="#Shearing" title="Permalink to this headline">¶</a></h3>
<p>Shearing transformation (a.k.a transvection) is a type of transformation where each point is displaced by a distance proportional to the perpendicular distance from the point’s parallel line. In 3D, planes are sheared instead of points.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># An example of reflection in Python:</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">]])</span>

<span class="n">X_right_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X_upside_down</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">X_right_left</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_upside_down</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[3 2 1]
 [6 4 1]]
[[1 4 6]
 [1 2 3]]
</pre></div></div>
</div>
<p><p><img alt="8bbb8177aba5491aaca402e7348dec68" class="no-scaled-link" src="../_images/todo_ico.png" style="width: 42px; height: 42px;" /></p>
</p></section>
<section id="Exercise-3.2.1:">
<h3><em>Exercise 3.2.1</em>:<a class="headerlink" href="#Exercise-3.2.1:" title="Permalink to this headline">¶</a></h3>
<p>Implement functions that return transformation matrices for 2D rotation, shear and reflection. You can find the templates for these three function definitions in <code class="docutils literal notranslate"><span class="pre">SECTION</span> <span class="pre">1</span></code> of the <code class="docutils literal notranslate"><span class="pre">registration.py</span></code> module. To test your implementation, run the <code class="docutils literal notranslate"><span class="pre">transforms_test()</span></code> script from the <code class="docutils literal notranslate"><span class="pre">registration_tests.py</span></code> module and make sure that the output matches the figure below.</p>
<center width="100%"><p><img alt="4d4c516e9a8148aeb61daaaec5f7daec" class="no-scaled-link" src="../_images/transforms_test.png" style="width: 800px;" /></p>
</center><div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">registration_tests</span> <span class="kn">import</span> <span class="n">transforms_test</span>

<span class="c1">#transforms_test()</span>
</pre></div>
</div>
</div>
<p><p><img alt="de39f00187554d67a648348049b96b22" class="no-scaled-link" src="../_images/question_ico.png" style="width: 42px; height: 42px;" /></p>
</p></section>
<section id="Question-3.2.1:">
<h3><em>Question 3.2.1</em>:<a class="headerlink" href="#Question-3.2.1:" title="Permalink to this headline">¶</a></h3>
<p><strong>What is rigid and what affine transformation? How many degrees of freedom dothese two types of transformations have in 2D?</strong></p>
<p>Type your answer here</p>
<p><p><img alt="2ab3ce87b9eb4dd6b920a0a47c8c3f68" class="no-scaled-link" src="../_images/question_ico.png" style="width: 42px; height: 42px;" /></p>
</p></section>
<section id="Question-3.2.2:">
<h3><em>Question 3.2.2</em>:<a class="headerlink" href="#Question-3.2.2:" title="Permalink to this headline">¶</a></h3>
<p><strong>What is the minimum number of corresponding point pairs needed to fit a 2D affine transform? How about 3D? Motivate your answer.</strong></p>
<p>Type your answer here</p>
<p><p><img alt="9f396decfd6b44d7bcf03d899577da66" class="no-scaled-link" src="../_images/read_ico.png" style="width: 42px; height: 42px;" /></p>
</p></section>
</section>
<section id="3.3-Transform-composition">
<h2>3.3 Transform composition<a class="headerlink" href="#3.3-Transform-composition" title="Permalink to this headline">¶</a></h2>
<p>Geometrical transformations can be combined by multiplying transformation matrices. These compositions may involve rotation and translation, or even rotation, scaling, shearing, reflection and translation altogether. For example, the following (conceptual) command first applies a 90° rotation to an object and then a vertical reflection: <code class="docutils literal notranslate"><span class="pre">X_t</span> <span class="pre">=</span> <span class="pre">reg.reflect(-1,1).dot(reg.rotate(np.pi/2)).dot(X)</span></code>.</p>
<p><p><img alt="b837ed78116a4bf1ab3748f1d04365c8" class="no-scaled-link" src="../_images/question_ico.png" style="width: 42px; height: 42px;" /></p>
</p><section id="Question-3.3.1:">
<h3><em>Question 3.3.1:</em><a class="headerlink" href="#Question-3.3.1:" title="Permalink to this headline">¶</a></h3>
<p><strong>Would the result be different if the two transformations in the example above are applied in reversed order? Motivate your answer.</strong></p>
<p>Type your answer here</p>
<p><p><img alt="3902ff94a45240dfa8cb2ea63060eb5a" class="no-scaled-link" src="../_images/question_ico.png" style="width: 42px; height: 42px;" /></p>
</p></section>
<section id="Question-3.3.2:">
<h3><em>Question 3.3.2:</em><a class="headerlink" href="#Question-3.3.2:" title="Permalink to this headline">¶</a></h3>
<p><strong>How can you compute the inverse of an affine transformation represented with a transformation matrix?</strong></p>
<p>Type your answer here</p>
<p><p><img alt="72a43dc68e154a6485239aeff16b2f1d" class="no-scaled-link" src="../_images/todo_ico.png" style="width: 42px; height: 42px;" /></p>
</p></section>
<section id="Exercise-3.3.1:">
<h3><em>Exercise 3.3.1</em>:<a class="headerlink" href="#Exercise-3.3.1:" title="Permalink to this headline">¶</a></h3>
<p>Test a few more examples of combining transformations. Save the examples in the <code class="docutils literal notranslate"><span class="pre">combining_transforms()</span></code> script template in the <a class="reference external" href="../code/registration_tests.py">registration_tests.py</a> module.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">registration_tests</span> <span class="kn">import</span> <span class="n">combining_transforms</span>
<span class="c1">#combining_transforms()</span>
</pre></div>
</div>
</div>
<p><p><img alt="2f2c60619e8f4f208aaed9c3aef05f3b" class="no-scaled-link" src="../_images/read_ico.png" style="width: 42px; height: 42px;" /></p>
</p></section>
</section>
<section id="3.4-Homogeneous-coordinates">
<h2>3.4 Homogeneous coordinates<a class="headerlink" href="#3.4-Homogeneous-coordinates" title="Permalink to this headline">¶</a></h2>
<p>As mentioned in the beginning of the previous exercise, translation can be performed by adding a translation vector to the coordinates of an object. Translation can be combined with other geometrical transformations, for example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">registration</span> <span class="k">as</span> <span class="nn">reg</span>
<span class="kn">import</span> <span class="nn">registration_util</span> <span class="k">as</span> <span class="nn">util</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">test_object</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># translation vector</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>

<span class="c1"># rotate by 45 deg.</span>
<span class="n">X_rot</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># translate by 10 in the horizontal and 20 in the vertical direction</span>
<span class="n">X_rot_tran</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">X_rot_tran</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">X_rot</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">X_rot_tran</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">X_rot</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">util</span><span class="o">.</span><span class="n">plot_object</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
<span class="n">util</span><span class="o">.</span><span class="n">plot_object</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">X_rot_tran</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/reader_1.1_Registration_geometrical-transformations_48_0.png" src="../_images/reader_1.1_Registration_geometrical-transformations_48_0.png" />
</div>
</div>
<p>However, this way of combining translation with other transformations can be a bit cumbersome (it somewhat complicates the mathematical notation and implementation in code). The transformations that you have implemented in the previous exercise can be straightforwardly combined with translation by converting the transformation matrix to homogeneous form. This matrix can then be applied to the homogeneous coordinates (details can be found in the lecture slides). The function <code class="docutils literal notranslate"><span class="pre">c2h()</span></code> given below
(also available in the <a class="reference external" href="../code/registration_util.py">registration_util.py</a> module) implements conversion from Cartesian coordinates to homogeneous coordinates. As you can see from the code, this conversion is performed by simply adding an additional row of coordinates with all ones:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">registration_util</span> <span class="k">as</span> <span class="nn">util</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">test_object</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Xh</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">c2h</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X:</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Xh:</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Xh</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
X:
[[-1.09090909 -1.09090909 -0.59090909 -0.59090909  0.90909091  0.90909091
  -0.59090909 -0.59090909  1.90909091  1.90909091 -1.09090909]
 [ 2.18181818 -3.81818182 -3.81818182 -0.81818182 -0.81818182 -0.31818182
  -0.31818182  1.68181818  1.68181818  2.18181818  2.18181818]]

Xh:
[[-1.09090909 -1.09090909 -0.59090909 -0.59090909  0.90909091  0.90909091
  -0.59090909 -0.59090909  1.90909091  1.90909091 -1.09090909]
 [ 2.18181818 -3.81818182 -3.81818182 -0.81818182 -0.81818182 -0.31818182
  -0.31818182  1.68181818  1.68181818  2.18181818  2.18181818]
 [ 1.          1.          1.          1.          1.          1.
   1.          1.          1.          1.          1.        ]]

</pre></div></div>
</div>
<p><p><img alt="e02f5736f5ec4eafbe846f8d90f9a4af" class="no-scaled-link" src="../_images/todo_ico.png" style="width: 42px; height: 42px;" /></p>
</p><section id="Exercise-3.4.1:">
<h3><em>Exercise 3.4.1</em>:<a class="headerlink" href="#Exercise-3.4.1:" title="Permalink to this headline">¶</a></h3>
<p>Implement the function called <code class="docutils literal notranslate"><span class="pre">t2h()</span></code> in the <a class="reference external" href="../code/registration_util.py">registration_util.py</a> module that converts a transformation matrix and a translation vector to a transformation matrix in homogeneous form. The template for this definition is already provided in the module file. To test your function, verify that the <code class="docutils literal notranslate"><span class="pre">t2h_test()</span></code> script results in the same object as the example above (note that the function <code class="docutils literal notranslate"><span class="pre">plot_object()</span></code> also works with homogeneous coordinates):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">registration_tests</span> <span class="kn">import</span> <span class="n">t2h_test</span>

<span class="c1">#t2h_test()</span>
</pre></div>
</div>
</div>
<p>The rotation transformation rotates the objects counterclockwise around the origin of the coordinate system. To perform rotation around an arbitrary point, the following sequence of transformations must be applied: 1. Translate the object so the arbitrary rotation point is translated to the origin of the coordinate system 2. Rotate the object 3. Translate the object back so that the arbitrary rotation point is in the original location.</p>
<p>These three transformation can be combined by multiplying the three homogeneous transformation matrices. Combining transformation matrices in homogeneous form works in the same way as the “regular” transformation matrices, i.e. by matrix multiplication.</p>
</section>
</section>
<section id="References">
<h2>References<a class="headerlink" href="#References" title="Permalink to this headline">¶</a></h2>
<p>[1] <strong>Recommended reading:</strong> Fitzpatrick, J.M., Hill, D.L. and Maurer Jr, C.R., Image registration. <a class="reference external" href="https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.464.5408&amp;rep=rep1&amp;type=pdf">LINK</a></p>
<p>[2] <strong>Recommended reading:</strong> Kolter, Z. Do, C. Linear algebra review and reference. <a class="reference external" href="http://cs229.stanford.edu/section/cs229-linalg.pdf">LINK</a></p>
<p>[3] Maintz JB, Viergever MA. A survey of medical image registration. Med Image Anal. 1998;2(1):1–36. <a class="reference external" href="https://pubmed.ncbi.nlm.nih.gov/10638851/">LINK</a></p>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="1.2_Registration_point-based-registration.html" class="btn btn-neutral float-right" title="Topic 1.2: Point-based registration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="0.1_Python_programming_skills.html" class="btn btn-neutral float-left" title="Topic 0.1: Course practicalities" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Daniel Krahulec.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>